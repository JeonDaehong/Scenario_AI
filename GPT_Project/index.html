<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Game</title>
    <style>

      body {
        margin: 0;
        padding: 0;
        background-color: #212121;
        background-image: url('img/background-image.png');
      }

      .game-div {
        align-items: center;
      }

      canvas {
        border-image: linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00) 1;
        border: 12px solid #212121;
        border-radius: 30px;
        background-color: white;
        background-clip: padding-box;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }
    </style>
    <script>
    </script>
</head>
<body>
    <div class="game-div">
      <canvas id="gameCanvas" width="1000" height="700"></canvas>
    </div>
    <script>
      // 캔버스와 컨텍스트 설정
      const canvas = document.getElementById('gameCanvas');
      const context = canvas.getContext('2d');

      // 게임 맵 정보
      const mapWidth = 2000;
      const mapHeight = 2000;

      // 플레이어 정보
      const player = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        width: 20,
        height: 20,
        speed: 5
      };

      // 건물 정보
      const building = {
        x: 400,
        y: 300,
        width: 100,
        height: 200
      };

      // NPC 정보
      const npc = {
        x: 600,
        y: 500,
        width: 30,
        height: 30
      };

      // 키 입력 처리
      const keys = {};

      // 대화 상태
      let isTalking = false;
      let isConversationStarted = false;

      window.addEventListener('keydown', (event) => {
        keys[event.keyCode] = true;

        // 대화 중 F 키를 누르면 대화 종료
        if (isTalking && event.keyCode === 70) {
          isTalking = false;
          isConversationStarted = false;
        }
      });
      window.addEventListener('keyup', (event) => {
        keys[event.keyCode] = false;
      });

      // 게임 루프
      function gameLoop() {
        // 플레이어 이동 처리
        if (keys[37] && player.x > player.speed && !checkCollision(player.x - player.speed, player.y, player.width, player.height, building.x, building.y, building.width, building.height)) {
          player.x -= player.speed; // 왼쪽 화살표
        }
        if (keys[39] && player.x < canvas.width - player.width - player.speed && !checkCollision(player.x + player.speed, player.y, player.width, player.height, building.x, building.y, building.width, building.height)) {
          player.x += player.speed; // 오른쪽 화살표
        }
        if (keys[38] && player.y > player.speed && !checkCollision(player.x, player.y - player.speed, player.width, player.height, building.x, building.y, building.width, building.height)) {
          player.y -= player.speed; // 위쪽 화살표
        }
        if (keys[40] && player.y < canvas.height - player.height - player.speed  && !checkCollision(player.x, player.y + player.speed, player.width, player.height, building.x, building.y, building.width, building.height)) {
          player.y += player.speed; // 아래쪽 화살표
        }

        // 건물 충돌 검사
        function checkCollision(x1, y1, width1, height1, x2, y2, width2, height2) {
          return x1 < x2 + width2 &&
            x1 + width1 > x2 &&
            y1 < y2 + height2 &&
            y1 + height1 > y2;
        }

        // 카메라 위치 조정
        const cameraX = Math.max(
          0,
          Math.min(player.x - canvas.width / 2, mapWidth - canvas.width)
        );
        const cameraY = Math.max(
          0,
          Math.min(player.y - canvas.height / 2, mapHeight - canvas.height)
        );

        // 캔버스 초기화
        context.clearRect(0, 0, canvas.width, canvas.height);

        // 맵 그리기
        context.fillStyle = 'gray';
        context.fillRect(0, 0, canvas.width, canvas.height);

        // 건물 그리기
        context.fillStyle = 'blue';
        context.fillRect(
          building.x - cameraX,
          building.y - cameraY,
          building.width,
          building.height
        );

        // NPC 그리기
        context.fillStyle = 'red';
        context.fillRect(
          npc.x - cameraX,
          npc.y - cameraY,
          npc.width,
          npc.height
        );

        // 플레이어 그리기
        context.fillStyle = 'green';
        context.fillRect(
          player.x - cameraX,
          player.y - cameraY,
          player.width,
          player.height
        );

        // NPC와 충돌 검사
        if (
          player.x < npc.x + npc.width &&
          player.x + player.width > npc.x &&
          player.y < npc.y + npc.height &&
          player.y + player.height > npc.y
        ) {
          if (keys[70]) {
            // F 키를 누르면 대화
            isTalking = true;
            isConversationStarted = true;
          }
        }

        // 대화 상태 표시
        if (isTalking) {
          context.fillStyle = 'white';
          context.fillRect(0, 550, 1000, 150);
          context.strokeRect(0, 550, 1000, 150);

          context.fillStyle = 'black';
          context.font = '23px Arial';
          context.fillText('NPC: 안녕하세요!', 30, 600);
        } else {
          context.clearRect(0, 550, 1000, 150);
          context.fillStyle = 'gray';
          context.fillRect(0, 550, 1000, 150);
        }

        // 다음 프레임 요청
        requestAnimationFrame(gameLoop);
      }

      // 게임 루프 시작
      gameLoop();
    </script>
</body>
</html>